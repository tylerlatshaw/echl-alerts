<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Recent ECHL Transactions</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

    <!-- iOS / PWA -->
    <link rel="apple-touch-icon" href="/icon-192.png">
    <meta name="theme-color" content="#4b5563">

    <link rel="manifest" href="/manifest.json">

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        padding: 16px;
        background: #fafafa;
      }

      h1 {
        margin-bottom: 12px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        background: #fff;
      }

      th, td {
        padding: 10px;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
        vertical-align: top;
      }

      th {
        background: #f3f4f6;
        font-weight: 600;
      }

      tr:hover {
        background: #f9fafb;
      }

      .meta {
        margin-bottom: 12px;
        color: #555;
        font-size: 0.9rem;
      }

      .error {
        color: #b91c1c;
      }
    </style>
  </head>

  <body>
    <h1>Recent ECHL Transactions</h1>
    <div class="meta" id="meta">Loadingâ€¦</div>

    <table id="table" hidden>
      <thead>
        <tr>
          <th>Player</th>
          <th>Team</th>
          <th>Detail</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="error" id="error"></div>

    <a href="/">Subscribe Now</a>

    <script>
      async function loadRecent() {
        try {
          const res = await fetch("/.netlify/functions/tx-latest?limit=50");
          if (!res.ok) {
            throw new Error("Failed to load transactions");
          }

          const json = await res.json();
          const data = json.data || [];

          document.getElementById("meta").textContent =
            `Showing ${data.length} most recent transactions`;

          const tbody = document.querySelector("#table tbody");
          tbody.innerHTML = "";

          for (const tx of data) {
            const tr = document.createElement("tr");

            tr.innerHTML = `
              <td>${tx.player}</td>
              <td>${tx.team}</td>
              <td>${tx.detail}</td>
              <td>${tx.date}</td>
            `;

            tbody.appendChild(tr);
          }

          document.getElementById("table").hidden = false;
        } catch (err) {
          document.getElementById("meta").textContent = "";
          document.getElementById("error").textContent =
            err?.message || "Error loading data";
        }
      }

      loadRecent();
    </script>
  </body>
</html>