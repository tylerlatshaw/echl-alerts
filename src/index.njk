---
layout: base.njk
title: "Recent Transactions | ECHL"
description: "Latest ECHL transactions."
---

<div class="mx-auto max-w-5xl p-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold">Recent Transactions</h1>
    <button id="refresh"
      class="rounded-xl px-3 py-2 text-sm font-semibold bg-[#5C3896] hover:bg-[#4a2d78]">
      Refresh
    </button>
  </div>

  <p id="error" class="mt-2 text-sm text-red-700"></p>

  <div class="mt-8 overflow-hidden rounded-lg">
    <div class="overflow-x-auto">
      <table id="table" class="min-w-full rounded-lg bg-gray-800 mb-4" hidden>
        <thead class="bg-slate-100 text-slate-700">
          <tr>
            <th class="px-4 py-3 font-semibold">Player</th>
            <th class="px-4 py-3 font-semibold">Team</th>
            <th class="px-4 py-3 font-semibold">Detail</th>
            <th class="px-4 py-3 font-semibold">Date</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200"></tbody>
      </table>
    </div>
  </div>

  <p id="meta" class="mt-2 text-lg text-gray-300">Loading…</p>

</div>

<script>

  async function loadRecent() {
    const meta = document.getElementById("meta");
    const errEl = document.getElementById("error");
    const table = document.getElementById("table");
    const tbody = document.querySelector("#table tbody");

    errEl.textContent = "";
    meta.textContent = "Loading…";
    table.hidden = true;

    try {
      const res = await fetch("/.netlify/functions/tx-latest?limit=50");
      if (!res.ok) 
        throw new Error(await res.text());
      
      const json = await res.json();
      const data = json.data || [];

      meta.textContent = `Showing ${data.length} most recent transactions`;
      tbody.innerHTML = "";

      for (const tx of data) {
        const tr = document.createElement("tr");
        tr.className = "hover:bg-gray-700";
        tr.innerHTML = `
          <td class="px-4 py-4 font-bold">${tx.player ?? ""}</td>
          <td class="px-4 py-4 text-gray-200">${tx.team ?? ""}</td>
          <td class="px-4 py-4 text-gray-200">${tx.detail ?? ""}</td>
          <td class="px-4 py-4 text-gray-200 whitespace-nowrap">${new Date(`${tx.date}T00:00:00`).toDateString() ?? ""}</td>
        `;
        tbody.appendChild(tr);
        console.log(tx.date)
      }

      table.hidden = false;
    } catch (e) {
      meta.textContent = "";
      errEl.textContent = e
        ?.message || "Error loading data";
    }
  }

  document
    .getElementById("refresh")
    .addEventListener("click", loadRecent);
  loadRecent();
</script>